<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ü–æ–∏—Å–∫ –∂–∏–ª—å—è –Ω–∞ –ü—Ö—É–∫–µ—Ç–µ</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            margin: 0;
            padding: 15px;
            background-color: #f0f2f5;
            color: #333;
            overflow-x: hidden;
        }
        h1 {
            font-size: 24px;
            text-align: center;
            color: #1a73e8;
            margin: 0 0 20px;
            font-weight: 600;
        }
        .progress-bar {
            width: 100%;
            height: 8px;
            background-color: #e0e0e0;
            border-radius: 4px;
            margin-bottom: 20px;
            overflow: hidden;
        }
        .progress {
            height: 100%;
            background-color: #1a73e8;
            width: 8.33%;
            transition: width 0.3s ease-in-out;
        }
        .step {
            display: none;
            animation: fadeIn 0.3s ease-in;
        }
        .step.active {
            display: block;
        }
        p {
            font-size: 18px;
            margin: 0 0 15px;
            color: #555;
            font-weight: 500;
        }
        button {
            background-color: #1a73e8;
            color: white;
            border: none;
            padding: 14px;
            margin: 8px 0;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            width: 100%;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            transition: background-color 0.2s ease, transform 0.1s ease;
        }
        button:hover, button:active {
            background-color: #1557b0;
            transform: scale(0.98);
        }
        select, input[type="date"] {
            width: 100%;
            padding: 14px;
            margin: 8px 0;
            border-radius: 8px;
            border: 1px solid #ddd;
            font-size: 16px;
            background-color: #fff;
            box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.05);
            box-sizing: border-box;
        }
        .recommendation {
            color: #777;
            font-size: 14px;
            margin: 10px 0 0;
            font-style: italic;
        }
        .history {
            margin-top: 20px;
            padding: 15px;
            background-color: #fff;
            border-radius: 8px;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.05);
            font-size: 14px;
            color: #444;
        }
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        @media (max-width: 400px) {
            h1 { font-size: 20px; }
            p { font-size: 16px; }
            button, select, input[type="date"] { font-size: 14px; padding: 12px; }
        }
    </style>
</head>
<body>
    <h1 id="title">–ü–æ–∏—Å–∫ –∂–∏–ª—å—è –Ω–∞ –ü—Ö—É–∫–µ—Ç–µ</h1>
    <div class="progress-bar">
        <div class="progress"></div>
    </div>

    <!-- –®–∞–≥ 1: –í—ã–±–µ—Ä–∏ —è–∑—ã–∫ -->
    <div id="step1" class="step active">
        <p id="lang-text">üåç –í—ã–±–µ—Ä–∏ —è–∑—ã–∫:</p>
        <select id="lang">
            <option value="ru">–†—É—Å—Å–∫–∏–π</option>
            <option value="en">English</option>
        </select>
        <button id="step1-btn">–î–∞–ª–µ–µ</button>
    </div>

    <!-- –®–∞–≥ 2: –í—ã–±–µ—Ä–∏ –≤–∞–ª—é—Ç—É -->
    <div id="step2" class="step">
        <p id="currency-text">üí∏ –í—ã–±–µ—Ä–∏ –≤–∞–ª—é—Ç—É:</p>
        <select id="currency">
            <option value="THB">THB</option>
            <option value="USD">USD</option>
            <option value="RUB">RUB</option>
        </select>
        <button id="step2-btn">–î–∞–ª–µ–µ</button>
    </div>

    <!-- –®–∞–≥ 3: –í—ã–±–µ—Ä–∏ —Ç–∏–ø –∂–∏–ª—å—è -->
    <div id="step3" class="step">
        <p id="type-text">üè° –í—ã–±–µ—Ä–∏ —Ç–∏–ø –∂–∏–ª—å—è:</p>
        <button onclick="selectOption('type', 'apartment', 'step4')">–ö–≤–∞—Ä—Ç–∏—Ä–∞ / Apartment</button>
        <button onclick="selectOption('type', 'villa', 'step4')">–í–∏–ª–ª–∞ / Villa</button>
        <button onclick="selectOption('type', 'house', 'step4')">–î–æ–º / House</button>
    </div>

    <!-- –®–∞–≥ 4: –£–∫–∞–∂–∏ –¥–∞—Ç—ã –ø–æ–µ–∑–¥–∫–∏ -->
    <div id="step4" class="step">
        <p id="dates-text">üìÖ –£–∫–∞–∂–∏ –¥–∞—Ç—ã –ø–æ–µ–∑–¥–∫–∏:</p>
        <input type="date" id="start_date" min="2025-03-11">
        <input type="date" id="end_date" min="2025-03-12">
        <button id="step4-btn">–î–∞–ª–µ–µ</button>
    </div>

    <!-- –®–∞–≥ 5: –í—ã–±–µ—Ä–∏ –±—é–¥–∂–µ—Ç (THB) -->
    <div id="step5" class="step">
        <p id="budget-text">üí∞ –í—ã–±–µ—Ä–∏ –±—é–¥–∂–µ—Ç (THB):</p>
        <button onclick="selectOption('budget', '15000', 'step6')">–î–æ 15,000</button>
        <button onclick="selectOption('budget', '30000', 'step6')">15,000-30,000</button>
        <button onclick="selectOption('budget', '40000', 'step6')">30,000+</button>
    </div>

    <!-- –®–∞–≥ 6: –í—ã–±–µ—Ä–∏ —Ä–∞–π–æ–Ω -->
    <div id="step6" class="step">
        <p id="area-text">üìç –í—ã–±–µ—Ä–∏ —Ä–∞–π–æ–Ω:</p>
        <button onclick="selectOption('area', 'patong', 'step7')">–ü–∞—Ç–æ–Ω–≥ / Patong</button>
        <button onclick="selectOption('area', 'kata', 'step7')">–ö–∞—Ç–∞ / Kata</button>
        <button onclick="selectOption('area', 'karon', 'step7')">–ö–∞—Ä–æ–Ω / Karon</button>
        <div id="area-recommendation" class="recommendation"></div>
    </div>

    <!-- –®–∞–≥ 7: –°–∫–æ–ª—å–∫–æ —Å–ø–∞–ª–µ–Ω? -->
    <div id="step7" class="step">
        <p id="bedrooms-text">üõèÔ∏è –°–∫–æ–ª—å–∫–æ —Å–ø–∞–ª–µ–Ω?</p>
        <button onclick="selectOption('bedrooms', '1', 'step8')">1 —Å–ø–∞–ª—å–Ω—è / 1 bedroom</button>
        <button onclick="selectOption('bedrooms', '2', 'step8')">2 —Å–ø–∞–ª—å–Ω–∏ / 2 bedrooms</button>
        <button onclick="selectOption('bedrooms', '3', 'step8')">3+ —Å–ø–∞–ª—å–Ω–∏ / 3+ bedrooms</button>
    </div>

    <!-- –®–∞–≥ 8: –ù—É–∂–µ–Ω –±–∞—Å—Å–µ–π–Ω? -->
    <div id="step8" class="step">
        <p id="pool-text">üèä –ù—É–∂–µ–Ω –±–∞—Å—Å–µ–π–Ω?</p>
        <button onclick="selectOption('pool', 'yes', 'step9')">–î–∞ / Yes</button>
        <button onclick="selectOption('pool', 'no', 'step9')">–ù–µ—Ç / No</button>
    </div>

    <!-- –®–∞–≥ 9: –ù—É–∂–Ω–∞ –∫—É—Ö–Ω—è? -->
    <div id="step9" class="step">
        <p id="kitchen-text">üç≥ –ù—É–∂–Ω–∞ –∫—É—Ö–Ω—è?</p>
        <button onclick="selectOption('kitchen', 'yes', 'step10')">–î–∞ / Yes</button>
        <button onclick="selectOption('kitchen', 'no', 'step10')">–ù–µ—Ç / No</button>
    </div>

    <!-- –®–∞–≥ 10: –ù—É–∂–µ–Ω –∫–æ–Ω–¥–∏—Ü–∏–æ–Ω–µ—Ä? -->
    <div id="step10" class="step">
        <p id="ac-text">‚ùÑÔ∏è –ù—É–∂–µ–Ω –∫–æ–Ω–¥–∏—Ü–∏–æ–Ω–µ—Ä?</p>
        <button onclick="selectOption('ac', 'yes', 'step11')">–î–∞ / Yes</button>
        <button onclick="selectOption('ac', 'no', 'step11')">–ù–µ—Ç / No</button>
    </div>

    <!-- –®–∞–≥ 11: –ö–∞–∫ –¥–∞–ª–µ–∫–æ –æ—Ç –ø–ª—è–∂–∞? -->
    <div id="step11" class="step">
        <p id="beach-text">üåä –ö–∞–∫ –¥–∞–ª–µ–∫–æ –æ—Ç –ø–ª—è–∂–∞?</p>
        <button onclick="selectOption('beach_dist', '300', 'step12')">–î–æ 300 –º / Up to 300 m</button>
        <button onclick="selectOption('beach_dist', '800', 'step12')">–î–æ 800 –º / Up to 800 m</button>
        <button onclick="selectOption('beach_dist', 'any', 'step12')">–õ—é–±–æ–µ / Any</button>
    </div>

    <!-- –®–∞–≥ 12: –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π —Ä–µ–π—Ç–∏–Ω–≥? -->
    <div id="step12" class="step">
        <p id="rating-text">‚≠ê –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π —Ä–µ–π—Ç–∏–Ω–≥?</p>
        <button onclick="selectOption('rating', '4.0', null, true)">4.0+</button>
        <button onclick="selectOption('rating', '4.5', null, true)">4.5+</button>
        <button onclick="selectOption('rating', '0', null, true)">–õ—é–±–æ–π / Any</button>
        <div id="history" class="history"></div>
    </div>

    <script>
        let searchData = {};
        let currentStep = 1;
        const totalSteps = 12;

        // –û–±—ä–µ–∫—Ç –ª–æ–∫–∞–ª–∏–∑–∞—Ü–∏–∏
        const langText = {
            ru: {
                title: "–ü–æ–∏—Å–∫ –∂–∏–ª—å—è –Ω–∞ –ü—Ö—É–∫–µ—Ç–µ",
                lang: "üåç –í—ã–±–µ—Ä–∏ —è–∑—ã–∫:",
                currency: "üí∏ –í—ã–±–µ—Ä–∏ –≤–∞–ª—é—Ç—É:",
                type: "üè° –í—ã–±–µ—Ä–∏ —Ç–∏–ø –∂–∏–ª—å—è:",
                dates: "üìÖ –£–∫–∞–∂–∏ –¥–∞—Ç—ã –ø–æ–µ–∑–¥–∫–∏:",
                budget: "üí∞ –í—ã–±–µ—Ä–∏ –±—é–¥–∂–µ—Ç (THB):",
                area: "üìç –í—ã–±–µ—Ä–∏ —Ä–∞–π–æ–Ω:",
                bedrooms: "üõèÔ∏è –°–∫–æ–ª—å–∫–æ —Å–ø–∞–ª–µ–Ω?",
                pool: "üèä –ù—É–∂–µ–Ω –±–∞—Å—Å–µ–π–Ω?",
                kitchen: "üç≥ –ù—É–∂–Ω–∞ –∫—É—Ö–Ω—è?",
                ac: "‚ùÑÔ∏è –ù—É–∂–µ–Ω –∫–æ–Ω–¥–∏—Ü–∏–æ–Ω–µ—Ä?",
                beach: "üåä –ö–∞–∫ –¥–∞–ª–µ–∫–æ –æ—Ç –ø–ª—è–∂–∞?",
                rating: "‚≠ê –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π —Ä–µ–π—Ç–∏–Ω–≥?",
                next: "–î–∞–ª–µ–µ",
                areaRec: "–ü–∞—Ç–æ–Ω–≥ ‚Äî –¥–ª—è —Ç—É—Å–æ–≤–æ–∫, –ö–∞—Ç–∞ ‚Äî –¥–ª—è –æ—Ç–¥—ã—Ö–∞.",
                history: "–ü–æ—Å–ª–µ–¥–Ω–∏–π –ø–æ–∏—Å–∫:"
            },
            en: {
                title: "Phuket Housing Search",
                lang: "üåç Choose language:",
                currency: "üí∏ Choose currency:",
                type: "üè° Choose housing type:",
                dates: "üìÖ Specify travel dates:",
                budget: "üí∞ Choose budget (THB):",
                area: "üìç Choose area:",
                bedrooms: "üõèÔ∏è How many bedrooms?",
                pool: "üèä Need a pool?",
                kitchen: "üç≥ Need a kitchen?",
                ac: "‚ùÑÔ∏è Need air conditioning?",
                beach: "üåä How far from the beach?",
                rating: "‚≠ê Minimum rating?",
                next: "Next",
                areaRec: "Patong for parties, Kata for relaxation.",
                history: "Last search:"
            }
        };

        // –§—É–Ω–∫—Ü–∏—è –≤—ã–±–æ—Ä–∞ –æ–ø—Ü–∏–∏
        function selectOption(key, value, nextStepId, submit = false) {
            searchData[key] = value;
            if (submit) {
                searchData.lang = document.getElementById("lang").value;
                searchData.currency = document.getElementById("currency").value;
                searchData.start_date = document.getElementById("start_date").value.replace(/-/g, ".");
                searchData.end_date = document.getElementById("end_date").value.replace(/-/g, ".");
                if (!searchData.start_date || !searchData.end_date || new Date(searchData.end_date) <= new Date(searchData.start_date)) {
                    alert(searchData.lang === "ru" ? "–£–∫–∞–∂–∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –¥–∞—Ç—ã!" : "Enter valid dates!");
                    return;
                }
                Telegram.WebApp.sendData(JSON.stringify(searchData));
                Telegram.WebApp.close();
            } else if (nextStepId) {
                showStep(nextStepId);
            }
        }

        // –§—É–Ω–∫—Ü–∏—è –ø–æ–∫–∞–∑–∞ —à–∞–≥–∞
        function showStep(stepId) {
            const currentStepElement = document.querySelector(".step.active");
            if (currentStepElement) {
                currentStepElement.classList.remove("active");
            }
            const nextStepElement = document.getElementById(stepId);
            if (nextStepElement) {
                nextStepElement.classList.add("active");
                currentStep++;
                document.querySelector(".progress").style.width = `${(currentStep / totalSteps) * 100}%`;
                updateLanguage();
                if (stepId === "step6") {
                    document.getElementById("area-recommendation").textContent = langText[searchData.lang || "ru"].areaRec;
                }
                if (stepId === "step12") {
                    showHistory();
                }
            } else {
                alert("–û—à–∏–±–∫–∞: —à–∞–≥ –Ω–µ –Ω–∞–π–¥–µ–Ω!");
            }
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —è–∑—ã–∫–∞
        function updateLanguage() {
            const lang = document.getElementById("lang").value;
            document.getElementById("title").textContent = langText[lang].title;
            document.getElementById("lang-text").textContent = langText[lang].lang;
            document.getElementById("currency-text").textContent = langText[lang].currency;
            document.getElementById("type-text").textContent = langText[lang].type;
            document.getElementById("dates-text").textContent = langText[lang].dates;
            document.getElementById("budget-text").textContent = langText[lang].budget;
            document.getElementById("area-text").textContent = langText[lang].area;
            document.getElementById("bedrooms-text").textContent = langText[lang].bedrooms;
            document.getElementById("pool-text").textContent = langText[lang].pool;
            document.getElementById("kitchen-text").textContent = langText[lang].kitchen;
            document.getElementById("ac-text").textContent = langText[lang].ac;
            document.getElementById("beach-text").textContent = langText[lang].beach;
            document.getElementById("rating-text").textContent = langText[lang].rating;
            document.querySelectorAll("button[id$='-btn']").forEach(btn => {
                btn.textContent = langText[lang].next;
            });
        }

        // –ü–æ–∫–∞–∑ –∏—Å—Ç–æ—Ä–∏–∏ –ø–æ–∏—Å–∫–∞
        function showHistory() {
            const historyDiv = document.getElementById("history");
            const lang = document.getElementById("lang").value;
            if (typeof user_data !== "undefined" && Telegram.WebApp.initDataUnsafe.user) {
                const history = user_data[String(Telegram.WebApp.initDataUnsafe.user.id)]?.last_search;
                if (history) {
                    historyDiv.innerHTML = `<strong>${langText[lang].history}</strong><br>${history.type} –≤ / in ${history.area}, ${history.start_date} - ${history.end_date}`;
                }
            }
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–Ω–æ–ø–æ–∫
        document.getElementById("step1-btn").addEventListener("click", function() {
            showStep("step2");
        });
        document.getElementById("step2-btn").addEventListener("click", function() {
            showStep("step3");
        });
        document.getElementById("step4-btn").addEventListener("click", function() {
            showStep("step5");
        });

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram Web App
        Telegram.WebApp.ready();
        Telegram.WebApp.expand();
        Telegram.WebApp.MainButton.hide();
        document.getElementById("lang").addEventListener("change", updateLanguage);
        updateLanguage();
    </script>
</body>
</html>
